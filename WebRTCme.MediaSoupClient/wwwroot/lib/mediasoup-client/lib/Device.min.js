/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/mediasoup-client@3.6.34/lib/Device.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,i){void 0===i&&(i=t),e[i]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Device=exports.detectDevice=void 0;const bowser_1=__importDefault(require("bowser")),Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),errors_1=require("./errors"),utils=__importStar(require("./utils")),ortc=__importStar(require("./ortc")),Transport_1=require("./Transport"),Chrome74_1=require("./handlers/Chrome74"),Chrome70_1=require("./handlers/Chrome70"),Chrome67_1=require("./handlers/Chrome67"),Chrome55_1=require("./handlers/Chrome55"),Firefox60_1=require("./handlers/Firefox60"),Safari12_1=require("./handlers/Safari12"),Safari11_1=require("./handlers/Safari11"),Edge11_1=require("./handlers/Edge11"),ReactNative_1=require("./handlers/ReactNative"),logger=new Logger_1.Logger("Device");function detectDevice(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void logger.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(logger.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)logger.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,r=bowser_1.default.getParser(e),t=r.getEngine();if(r.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(r.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(r.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(r.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(r.satisfies({firefox:">=60"}))return"Firefox60";if(r.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(r.satisfies({safari:">=11"}))return"Safari11";if(r.satisfies({"microsoft edge":">=11"})&&r.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(t.name&&"blink"===t.name.toLowerCase()){const r=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(r){const e=Number(r[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}logger.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",r.getBrowserName(),r.getBrowserVersion())}}exports.detectDevice=detectDevice;class Device{constructor({handlerName:e,handlerFactory:r,Handler:t}={}){if(this._loaded=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),t){if(logger.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof t)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=t}if(e&&r)throw new TypeError("just one of handlerName or handlerInterface can be given");if(r)this._handlerFactory=r;else{if(e)logger.debug("constructor() | handler given: %s",e);else{if(!(e=detectDevice()))throw new errors_1.UnsupportedError("device not supported");logger.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=Chrome74_1.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=Chrome70_1.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=Chrome67_1.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=Chrome55_1.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=Firefox60_1.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=Safari12_1.Safari12.createFactory();break;case"Safari11":this._handlerFactory=Safari11_1.Safari11.createFactory();break;case"Edge11":this._handlerFactory=Edge11_1.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=ReactNative_1.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let r;logger.debug("load() [routerRtpCapabilities:%o]",e),e=utils.clone(e,void 0);try{if(this._loaded)throw new errors_1.InvalidStateError("already loaded");ortc.validateRtpCapabilities(e),r=this._handlerFactory();const t=await r.getNativeRtpCapabilities();logger.debug("load() | got native RTP capabilities:%o",t),ortc.validateRtpCapabilities(t),this._extendedRtpCapabilities=ortc.getExtendedRtpCapabilities(t,e),logger.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=ortc.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=ortc.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities),ortc.validateRtpCapabilities(this._recvRtpCapabilities),logger.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await r.getNativeSctpCapabilities(),logger.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),ortc.validateSctpCapabilities(this._sctpCapabilities),logger.debug("load() succeeded"),this._loaded=!0,r.close()}catch(e){throw r&&r.close(),e}}canProduce(e){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:n,proprietaryConstraints:c,appData:d={}}){return logger.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:n,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:n,proprietaryConstraints:c,appData:d={}}){return logger.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:n,proprietaryConstraints:c,appData:d})}_createTransport({direction:e,id:r,iceParameters:t,iceCandidates:i,dtlsParameters:a,sctpParameters:o,iceServers:s,iceTransportPolicy:n,additionalSettings:c,proprietaryConstraints:d,appData:l={}}){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("string"!=typeof r)throw new TypeError("missing id");if("object"!=typeof t)throw new TypeError("missing iceParameters");if(!Array.isArray(i))throw new TypeError("missing iceCandidates");if("object"!=typeof a)throw new TypeError("missing dtlsParameters");if(o&&"object"!=typeof o)throw new TypeError("wrong sctpParameters");if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");const p=new Transport_1.Transport({direction:e,id:r,iceParameters:t,iceCandidates:i,dtlsParameters:a,sctpParameters:o,iceServers:s,iceTransportPolicy:n,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",p),p}}exports.Device=Device;
//# sourceMappingURL=/sm/62e68003d9b087a25541f62156df3d24c48fc7252e33bc12f6eb8cfb78b92b67.map